<html lang="en">
  <head>
    <title>Home.home</title>
    #extend("common_header")
        <script type="module">
      import { a } from '/scripts/main.js';

      window.app = a.app({
        onLoad: (app) => {
          a.select("current-vpn-state").onSelect(async (select) => {
            let elem = a.elem("current-vpn-state");
            elem.loading(true);
            let newDevice = await app.setState(select.value());
            elem.loading(false);
            select.setValue(newDevice.state)
          });
        },

        setState: async (newState) => {
          let response = await a.fetch("/api/vpn/deviceState", {
            method: "PUT",
            body: {
              device: "#(current.id)",
              newState: newState
            }
          });

          let newDevice = await response.json();
          return newDevice;
        }
      });
    </script>
  </head>
  <body>
      <main>
          <h1><a href="/">Home</a> - VPN</h1>
          <h2>Это устройство</h2>
          #if(current):
          <dl class="horizontal">
            <!-- Device ID: #(current.id) -->
            <dt>Имя</dt>
            <dd>#(current.name)</dd>
            <dt>Статус</dt>
            <dd>
              <select id="current-vpn-state" class="primary" value="#(current.state)">
                #for(state in availableStates):
                <option value="#(state)">#(state)</option>
                #endfor
              </select>
            </dd>
          </dl>
          #else:
          Чтобы использовать VPN устройство нужно <a href="/device">зарегистрировать</a>
          #endif

          <h2>Другие устройства</h2>
          <table id="all-devices-table">
          #for(device in allDevices):
            <tr a.id="#(device.id)">
              <td class="fill">#(device.name)</td>
              <td>#(device.address)</td>
              <td>
                  <select id="vpn-state" value="#(device.state)">
                    #for(state in availableStates):
                    <option value="#(state)">#(state)</option>
                    #endfor
                  </select>
              </td>
              <td>
                  <div class="button small" onClick="app.deleteDevice('#(device.id)')">-</div>
              </td>
            </tr>
          #endfor
        </table>
      </main>
  </body>
</html>
